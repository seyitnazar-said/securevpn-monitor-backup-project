План резервного копирования

**1\. Назначение**

\- Автоматическое создание резервных копий системы, исключая временные директории.

\- Хранение копий:

\- локально — в \`/var/backups\`;

\- удалённо — в MinIO (объектное хранилище S3-типа).

\- Контроль выполнения через лог-файл и метрики в Prometheus/Grafana.

**2\. Архитектура**

\- Bash-скрипт — отвечает за архивирование и загрузку.

\- Cron — запускает скрипт по расписанию.

\- MinIO — хранилище резервных копий.

\- Логи:

\- \`/var/log/backup_minio.log\` — для локального аудита;

\- метрики для Prometheus (например, \`backup_success\`, \`backup_failure\`).

\- Grafana — визуализация и алерты по статусу бэкапов.

**3\. Последовательность действий**

1\. Создание архива с датой (например, \`backup-2025-07-08.tar.gz\`).

2\. Сохранение архива в \`/var/backups\`.

3\. Загрузка архива в MinIO.

4\. Запись информации в лог-файл \`/var/log/backup_minio.log\`.

5\. Отправка результатов в Prometheus.

6\. Grafana отображает статус и оповещает в случае ошибок.

**4\. Ошибки и действия**

| Ошибка | Действие |
| --- | --- |
| Ошибка создания архива | Повторная попытка, запись в лог, уведомление. |
| Недостаточно места | Удаление старых архивов, лог, оповещение. |
| Ошибка загрузки в MinIO | Несколько попыток, сохранение копии локально. |
| Повреждённый архив | Отметка, лог, расследование. |
| Истёкшие ключи/доступ к MinIO | Остановка бэкапа, лог, уведомление, смена ключей. |

**5\. Хранение артефактов**

\- Архивы: \`/var/backups/backup-&lt;дата&gt;.tar.gz\`

\- MinIO: с таким же именем.

\- Логи: \`/var/log/backup_minio.log\`

\- Мониторинг: через метрики в Prometheus и дашборды в Grafana.

\- Планировщик: \`cron\`, например, ежедневно в 02:00.